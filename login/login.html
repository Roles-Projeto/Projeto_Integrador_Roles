<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tela de Login - Rol√™s</title>
    <link rel="stylesheet" href="../css/login.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header>
        <div id="header-wrap">
            <iframe id="site-header" src="../header/header.html" frameborder="0" scrolling="no" width="100%"
                height="80"></iframe>
        </div>
    </header>

    <main>
        <div class="login-container">
            <div class="login-box">
                <h1>Entrar no Rol√™s</h1>

                <div class="toggle-buttons">
                    <button id="cliente-btn" class="active">Cliente</button>
                    <button id="empresario-btn">Empres√°rio</button>
                </div>

                <p id="main-text" class="text-muted">
                    Encontre os melhores lugares para sair e se divertir
                </p>
                <p id="sub-text" class="small">Entre rapidamente com</p>

                <div class="social-login">
                    <button><i class="fab fa-google"></i></button>
                    <button><i class="fab fa-facebook-f"></i></button>
                    <button><i class="fab fa-apple"></i></button>
                </div>

                <div class="divider">
                    <span>ou</span>
                </div>

                <form id="login-form">
                    <input type="email" id="email" placeholder="E-mail" required>
                    <input type="password" id="password" placeholder="Senha" required>
                    <button type="submit" class="login-btn">Entrar</button>
                </form>

                <p class="register-link">
                    N√£o tem conta? <a href="../Cadastro/cadastro.html">Cadastre-se</a>
                </p>
            </div>
        </div>
    </main>

    <footer>
        <iframe src="../footer/footer.html" frameborder="0" scrolling="no" width="100%" height="auto"></iframe>
    </footer>

    <script>
        const clienteBtn = document.getElementById("cliente-btn");
        const empresarioBtn = document.getElementById("empresario-btn");
        const mainText = document.getElementById("main-text");
        const subText = document.getElementById("sub-text");
        const form = document.getElementById("login-form");
        
        const inputEmail = document.getElementById("email");
        const headerIframe = document.getElementById('site-header');

        // Fun√ß√£o para enviar a mensagem de login para o Header Iframe
        function enviarLoginParaHeader(email, userType) {
            const defaultName = (userType === 'empresario' ? 'Empres√°rio Rol√™s' : 'Cliente Rol√™s');

            if (headerIframe && headerIframe.contentWindow) {
                // Envia a mensagem para o iframe (para o header.html)
                headerIframe.contentWindow.postMessage({ 
                    action: 'LOGIN_SUCCESS', 
                    newName: defaultName, 
                    newEmail: email,
                    userType: userType
                }, '*');
                console.log('Mensagem enviada para o iframe: LOGIN_SUCCESS');
            } else {
                console.error('Erro: Iframe do Header n√£o encontrado ou ContentWindow indispon√≠vel.');
            }
        }

        // Alterna entre Cliente e Empres√°rio (L√≥gica MANTIDA)
        clienteBtn.addEventListener("click", () => {
            clienteBtn.classList.add("active");
            empresarioBtn.classList.remove("active");
            mainText.textContent = "Encontre os melhores lugares para sair e se divertir";
            subText.textContent = "Entre rapidamente com";
        });

        empresarioBtn.addEventListener("click", () => {
            empresarioBtn.classList.add("active");
            clienteBtn.classList.remove("active");
            mainText.textContent = "Cadastre seu estabelecimento e aumente sua visibilidade";
            subText.textContent = "Entre rapidamente com";
        });

        // L√≥gica de login
        form.addEventListener("submit", (e) => {
            e.preventDefault();

            const email = inputEmail.value;
            const password = document.getElementById("password").value;
            
            let userType = 'cliente';

            if (email && password) {
                // ‚ùå REMOVIDO: alert("‚úÖ Login efetuado com sucesso!");

                // 1. Determina o tipo de usu√°rio
                if (clienteBtn.classList.contains("active")) {
                    userType = 'cliente';
                } else if (empresarioBtn.classList.contains("active")) {
                    userType = 'empresario';
                }

                const defaultName = (userType === 'empresario' ? 'Empres√°rio Rol√™s' : 'Cliente Rol√™s');

                // üîë PASSO CRUCIAL: Salva dados no localStorage
                localStorage.setItem('userIsLoggedIn', 'true');
                localStorage.setItem('userType', userType); 
                localStorage.setItem('profileName', defaultName); 
                localStorage.setItem('profileEmail', email);

                // 2. Envia os dados para o Header (iframe)
                enviarLoginParaHeader(email, userType); 

                setTimeout(() => {
                    // Mant√©m o redirecionamento
                    if (userType === 'cliente') {
                        window.location.href = "../Perfil_usuario/Perfil_usuario.html"; 
                    } else if (userType === 'empresario') {
                        window.location.href = "../Perfil_empresario/Perfil_empresario.html"; 
                    }
                }, 50); 
            } else {
                // ‚úÖ MANTIDO: Aviso de erro obrigat√≥rio
                alert("‚ö†Ô∏è Preencha todos os campos (Email e Senha)!");
            }
        });
    </script>

</body>

</html>