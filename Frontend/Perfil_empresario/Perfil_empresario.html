<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Empres√°rio - Rol√™s</title>
    <link rel="stylesheet" href="../css/perfil-empresario.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header>
        <iframe id="site-header" src="../header/header.html" frameborder="0" scrolling="no" width="100%" height="220"
            style="position: fixed; top: 0; left: 0; z-index: 999999999;"></iframe>
    </header>

    <main>
        <div class="profile-container">
            <!-- CARD PRINCIPAL DE PERFIL -->
            <div class="profile-card">
                <div class="profile-pic-container">
                    <img id="profile-pic-display" src="../Imagens/Logo Restaurante.avif" alt="Logo do Restaurante"
                        class="profile-pic">
                    <label for="upload-pic-input" class="edit-pic-btn">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="upload-pic-input" accept="image/*" style="display: none;">
                </div>

                <h2 id="nome-restaurante">Restaurante Casa do Chef Jo√£o e Bar</h2>
                <p class="tag">Empres√°rio</p>

                <div class="profile-info">
                    <p><strong>E-mail:</strong> <span id="display-email">restaurantejoao@gmail.com</span></p>
                    <p><strong>Telefone:</strong> <span id="display-telefone">(62) 99888-7766</span></p>
                    <p><strong>Cidade:</strong> <span id="display-cidade">Goi√¢nia - GO</span></p>
                    <p><strong>Data de Cadastro:</strong> 15/04/2024</p>
                </div>

                <div class="buttons">
                    <button id="editar-btn"><i class="fa-solid fa-pen-to-square"></i> Editar Perfil</button>
                    <button id="sair-btn"><i class="fa-solid fa-right-from-bracket"></i> Sair</button>
                </div>
            </div>

            <!-- WRAPPER PARA FORMUL√ÅRIO E ESTAT√çSTICAS -->
            <div class="edit-and-stats-wrapper">
                <!-- FORMUL√ÅRIO DE EDI√á√ÉO -->
                <div class="edit-form-card" id="edit-form-card">
                    <h3 id="form-title">Editar Informa√ß√µes do Perfil</h3>
                    <form id="edit-form">
                        <label for="edit-nome-restaurante">Nome do Estabelecimento:</label>
                        <input type="text" id="edit-nome-restaurante" value="Restaurante Casa do Chef Jo√£o e Bar">

                        <label for="edit-email">E-mail:</label>
                        <input type="email" id="edit-email" value="restaurantejoao@gmail.com">

                        <label for="edit-telefone">Telefone:</label>
                        <input type="text" id="edit-telefone" value="(62) 99888-7766">

                        <label for="edit-cidade">Cidade:</label>
                        <input type="text" id="edit-cidade" value="Goi√¢nia - GO">

                        <div class="form-buttons">
                            <button type="submit" id="salvar-btn">Salvar Altera√ß√µes</button>
                            <button type="button" id="cancelar-btn">Cancelar</button>
                        </div>
                    </form>
                </div>

                <!-- ESTAT√çSTICAS SIMPLES -->
                <div class="stats-card" id="stats-card">
                    <div class="stat">
                        <i class="fa-solid fa-eye"></i>
                        <div>
                            <h3>Visualiza√ß√µes este m√™s</h3>
                            <p>1.245</p>
                        </div>
                    </div>
                    <div class="stat">
                        <i class="fa-solid fa-star"></i>
                        <div>
                            <h3>Avalia√ß√£o M√©dia</h3>
                            <p>4.8 ‚òÖ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <iframe src="../footer/footer.html" frameborder="0" scrolling="no" width="100%" height="250"></iframe>
    </footer>

    <script>
        const editarBtn = document.getElementById("editar-btn");
const sairBtn = document.getElementById("sair-btn");
const editFormCard = document.getElementById("edit-form-card");
const statsCard = document.getElementById("stats-card");
const cancelarBtn = document.getElementById("cancelar-btn");
const salvarBtn = document.getElementById("salvar-btn");

const displayNome = document.getElementById("nome-restaurante");
const displayEmail = document.getElementById("display-email");
const displayTelefone = document.getElementById("display-telefone");
const displayCidade = document.getElementById("display-cidade");

const inputNome = document.getElementById("edit-nome-restaurante");
const inputEmail = document.getElementById("edit-email");
const inputTelefone = document.getElementById("edit-telefone");
const inputCidade = document.getElementById("edit-cidade");

const profilePicDisplay = document.getElementById("profile-pic-display");
const uploadPicInput = document.getElementById("upload-pic-input");

// -----------------------------
// üîπ Carrega informa√ß√µes do LocalStorage
// -----------------------------
document.addEventListener('DOMContentLoaded', () => {
    const isLogged = localStorage.getItem('userIsLoggedIn') === 'true';
    const userType = localStorage.getItem('userType');

    if (!isLogged || userType !== 'empresario') {
        window.location.href = '../login/login.html';
        return;
    }

    // Preenche os campos do perfil com dados do localStorage
    const profileName = localStorage.getItem('profileName') || 'Nome do Estabelecimento';
    const profileEmail = localStorage.getItem('profileEmail') || 'email@exemplo.com';
    const profilePhone = localStorage.getItem('profilePhone') || '(00) 0000-0000';
    const profileCity = localStorage.getItem('profileCity') || 'Cidade - UF';
    const profilePhotoUrl = localStorage.getItem('profilePhotoUrl') || '../Imagens/Logo Restaurante.avif';

    displayNome.textContent = profileName;
    displayEmail.textContent = profileEmail;
    displayTelefone.textContent = profilePhone;
    displayCidade.textContent = profileCity;
    profilePicDisplay.src = profilePhotoUrl;

    inputNome.value = profileName;
    inputEmail.value = profileEmail;
    inputTelefone.value = profilePhone;
    inputCidade.value = profileCity;
});

// -----------------------------
// üîπ Formul√°rio de edi√ß√£o
// -----------------------------
function showEditForm() {
    editFormCard.style.display = 'block';
    statsCard.style.opacity = 0.3;
}

editarBtn.addEventListener('click', showEditForm);
cancelarBtn.addEventListener('click', () => {
    editFormCard.style.display = 'none';
    statsCard.style.opacity = 1;
});

salvarBtn.addEventListener('click', (e) => {
    e.preventDefault();

    displayNome.textContent = inputNome.value;
    displayEmail.textContent = inputEmail.value;
    displayTelefone.textContent = inputTelefone.value;
    displayCidade.textContent = inputCidade.value;

    editFormCard.style.display = 'none';
    statsCard.style.opacity = 1;

    // Salva no localStorage
    localStorage.setItem('profileName', inputNome.value);
    localStorage.setItem('profileEmail', inputEmail.value);
    localStorage.setItem('profilePhone', inputTelefone.value);
    localStorage.setItem('profileCity', inputCidade.value);

    // Atualiza o header em tempo real
    const headerIframe = document.getElementById('site-header');
    if (headerIframe) {
        headerIframe.contentWindow.postMessage({
            action: 'UPDATE_PROFILE_INFO',
            newName: inputNome.value,
            newEmail: inputEmail.value,
            newPicUrl: profilePicDisplay.src
        }, '*');
    }
});

// -----------------------------
// üîπ Atualizar foto de perfil
// -----------------------------
uploadPicInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const newPicUrl = event.target.result;
            profilePicDisplay.src = newPicUrl;

            localStorage.setItem('profilePhotoUrl', newPicUrl);

            const headerIframe = document.getElementById('site-header');
            if (headerIframe) {
                headerIframe.contentWindow.postMessage({
                    action: 'UPDATE_PROFILE_INFO',
                    newPicUrl: newPicUrl
                }, '*');
            }
        };
        reader.readAsDataURL(file);
    }
});

// -----------------------------
// üîπ Logout
// -----------------------------
sairBtn.addEventListener('click', () => {
    localStorage.removeItem('userIsLoggedIn');
    localStorage.removeItem('userType');
    window.location.href = '../login/logout-empresario.html';
});

    </script>
</body>

</html>
